<!DOCTYPE html>
<html>
<head>
	<title> Campus Mapper </title>
</head>
<body>
	<h1> Campus Mapper </h1>

	
	<div id="map-container" style="position: relative; width: 100%; height: 100%; border: 1px solid #ccc;">
		<canvas id="campus-map"></canvas>

		<div id="input-overlay" style="position: absolute; top: 10px; left: 10px; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
			<form class="prelim-info" data-info="room" id="room-form">
				<label for="room-id">Enter Room:</label>
				<input type="text" id="room-id" />
				<input type="submit" value="Submit" />
			</form>
			
			<form class="zoom-controls" data-info="zoom" id="zoom-form">
				<label for="room-id">Enter X-coord:</label>
				<input type="text" id="xcoord" />
				<input type="submit" value="Submit" />
				
				<label for="room-id">Enter Y-coord:</label>
				<input type="text" id="ycoord" />
				<input type="submit" value="Submit" />
				
				<label for="room-id">Enter zoom scale:</label>
				<input type="text" id="zoomscale" />
				<input type="submit" value="Submit" />
			</form>
		</div>

		<div id="toggle-input" style="position: absolute; top: 10px; left: 10px; cursor: pointer; display: none;">
			âž¤
		</div>
		

	</div>
	
	
	
	<style>
		html, body {
			margin: 0;
			padding: 0;
			height: 100%;
			display: flex;
			flex-direction: column;
			background-color: green;
		}
		

		
		h1 {
			text-align: center;
			font-family: verdana;
			font-size: 28px;
			color: white;
			margin-bottom: 25px;
		}
		
		#map-container {
			display: flex;
			flex: 1;
			background-color: grey;
			border-radius: 10px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			padding: 0px;
			margin-top: 0px;
			width: 550px;
		}
		
		
		#input-overlay {
			width: 155px
		}
		
		
		
		
		label {
			font-family: verdana;
			font-weight: bold;
			color: #555;
			width: 250px;
		}
		
		
		input[type="text"] {
			padding: 8px;
			border-radius: 5px;
			font-size: 16px;
			flex-grow: 1;
			border: 1px solid #ccc;
			width: 50%;
			box-sizing: border-box;
		}
		
		input[type="text"]:focus {
			background-color: lightgreen;
		}
		
		input[type="submit"] {
			background-color: #3BB143;
			color: white;
			padding: 10px 20px;
			font-size: 16px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			transition: 0.3s;
			align-self: center;
		}
		input[type="submit"]:hover {
			background-color: #0B6623;
		}
		
		
		form {
			display: flex;
			flex-direction: column;
			gap: 15px;
			width: 100%;
		}



		canvas {
			display: flex; 
			position: sticky; 
			top: 0; 
			left: 280px;
		}
		
		
		@media (max-width: 800px) {
		  .flex-container {
			flex-direction: column;
		  }
		}

		
		
	</style>
	
	<script>
		const canvas = document.getElementById("campus-map");
		const ctx = canvas.getContext("2d");

		const aspectRatio = 16 / 9; 

		
		let canvasWidth = window.innerWidth * 0.85;
		let canvasHeight = canvasWidth / aspectRatio;

		
		if (canvasHeight > window.innerHeight * 0.85) {
			canvasHeight = window.innerHeight * 0.85;
			canvasWidth = (canvasHeight) * aspectRatio;
		}

		
		canvas.width = canvasWidth;
		canvas.height = canvasHeight;
		
		const img = new Image();
		img.src = "https://s3.amazonaws.com/freecodecamp/relaxing-cat.jpg";
		
		
		
		
		
		const form = document.getElementById("room-form");
		
		
		const rows = 15;
		const diameter = canvas.height / rows; 
		const cols = Math.ceil(canvas.width / diameter);



		var zones = [];

		
		
		
		const isIOS = (
		  navigator.userAgent.match(/(iPod|iPhone|iPad)/) &&
		  navigator.userAgent.match(/AppleWebKit/)
		);
		
		var latitude;
		var longitude;
		function draw() {
			let watchId = navigator.geolocation.watchPosition(
			  function(position) {
				
				latitude = position.coords.latitude;
				longitude = position.coords.longitude;
				//console.log(`Updated Latitude: ${latitude}, Longitude: ${longitude}`);
			  },
			  function(error) {
				
				console.error("Error watching position:", error);
			  },
			  {
				enableHighAccuracy: true,
				timeout: 5000,
				maximumAge: 0
			  }
			);
			//41.502143341689326, -81.67854782348736
			ctx.clearRect(0, 0, canvas.width, canvas.height);

			createZones(diameter, cols);


			let xvalue = document.getElementById("xcoord").value;
			let yvalue = document.getElementById("ycoord").value
			let zoom = document.getElementById("zoomscale").value

			camera = { x: xvalue, y: yvalue, scale: zoom};


			renderScene(camera, diameter, cols);


			requestAnimationFrame(draw);
		}
					
		
		form.addEventListener("submit", function(event) {
			event.preventDefault();  // prevent page reload

			const roomName = document.getElementById("room-id").value;
			
			
			// Get user compass data (prompt for IOS other devices allow by default)
			if(isIOS){
				DeviceOrientationEvent.requestPermission()
				window.addEventListener("deviceorientation", handler, true);
			} else {
				window.addEventListener("deviceorientationabsolute", handler, true);
			}
			
			
			
			

		
		});
		var lat;
		var longit;
		
		
		function handler(e) {
			var compass = e.webkitCompassHeading || Math.abs(e.alpha - 360);
		}
		
		
		
		

		// Top left: 41.50328051569975, -81.67904912462858
		// Bottom left: 41.50146378558553, -81.67868811305225
		// Top Right: 41.5038595529573, -81.67282733226762
		// Bottom Right: 41.5021184731077, -81.67242593073586
		
		
		function createZones(diameter, cols) {
			let startX = diameter / 2;
			let startY = diameter / 2;
			
			for(let i = 0; i < 50; i++){
				for(let j = 0; j < cols; j++){
					let currZone = {
						x: startX + (j * diameter),
						y: startY + (i * diameter),
						activated: 0
					}
					zones.push(currZone);
				}
			}

			
		}
		
		function renderZones(diameter, cols) {	
			ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
			
			// Draw user location as a red dot
			ctx.beginPath();
			let mapX = latLonConvert(latitude, longitude).x;
			let mapY = latLonConvert(latitude, longitude).y;
			console.log(mapX, ", ", mapY);
			ctx.arc(mapX, mapY, 5, 0, 2 * Math.PI);
			ctx.fillStyle = "rgba(255, 0, 0, 1.0)";
			ctx.fill();
			ctx.strokeStyle = "black";
			ctx.stroke();
			
			for(let i = 0; i < 50; i++){
				for(let j = 0; j < cols; j++){
					let cx = zones[i * cols + j].x;
					let cy = zones[i * cols + j].y;
					let r = diameter / 2;
					
					if(!(cx > canvas.width || cy > canvas.height)){
						ctx.beginPath();
						ctx.arc(cx, cy, r, 0, 2 * Math.PI);

						if(mapX < (cx + (diameter / 2)) && mapX > (cx - (diameter / 2)) && mapY < (cy + (diameter / 2)) && mapY > (cy - (diameter / 2))){
							ctx.fillStyle = "rgba(0, 255, 0, 0.25)"; 
							ctx.fill();
						} else {
							ctx.fillStyle = "rgba(173, 216, 230, 0.25)"; 
							ctx.fill();
						}
						
					
								
							
						ctx.strokeStyle = "black"; 
						ctx.stroke();
					} 
				}
			}
			
			
		}
		
		function renderScene(camera, diameter, cols) {
			ctx.setTransform(camera.scale, 0, 0, camera.scale, -camera.x*camera.scale, -camera.y*camera.scale);
			renderZones(diameter, cols);
		}
		
		// Top left of image: 41.50385334040492, -81.6804914654469
		// Bottom right of image: 41.50134173780734, -81.67246588380492
		
		function latLonConvert(lat, lon){
			let xscale = (81.6804914654469 + lon) / (81.6804914654469 - 81.67246588380492);
			let yscale = (41.50385334040492 - lat) / (41.50385334040492 - 41.50134173780734);
			
			return {
				x: xscale * canvas.width,
				y: yscale * canvas.height
			}
		}
		
		
		img.onload = () => {
		  draw();
		};
		
		
		

		
	</script>
</body>

</html>
